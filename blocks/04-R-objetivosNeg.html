<section class="dho-objetivosneg" aria-labelledby="dho-objetivosneg-title">
  <div class="dho-objetivosneg-wrap">
    <header class="dho-objetivosneg-header">
      <p class="dho-kicker">BLOCO 04 | OBJETIVOS DO NEGÓCIO</p>
      <h2 id="dho-objetivosneg-title">Para onde o negócio quer ir e o que pode travar o caminho</h2>
      <p class="dho-subtitle">
        Este recorte reúne duas camadas que caminham juntas: a direção desejada para os próximos meses e os pontos internos que podem reduzir a velocidade da entrega.
      </p>
    </header>

    <!-- ATO 1 | DIREÇÃO -->
    <section class="dho-ato" aria-label="Direção do negócio">
      <div class="dho-ato-head">
        <h3 class="dho-ato-title">Direção percebida</h3>
        <p class="dho-ato-lead">
          Quando o negócio fala sobre futuro, aparecem três eixos com força: sustentação financeira, maturidade de gestão e impacto positivo. É um norte que combina resultado com construção.
        </p>
      </div>

      <div class="dho-sinteses" role="list" aria-label="Sínteses editoriais">
        <div class="dho-sintese" role="listitem">
          <p><strong>Sustentação financeira</strong> como horizonte, com desejo de ampliar conforto, segurança e autonomia no médio prazo.</p>
        </div>
        <div class="dho-sintese" role="listitem">
          <p><strong>Crescimento com consistência</strong>, buscando prosperar sem perder o controle do dia a dia e das decisões.</p>
        </div>
        <div class="dho-sintese" role="listitem">
          <p><strong>Maturidade de liderança</strong>, reconhecendo que crescer exige lidar com complexidade, pessoas e prioridades.</p>
        </div>
        <div class="dho-sintese" role="listitem">
          <p><strong>Ambiente de desenvolvimento</strong>, com intenção de fortalecer time, cultura e trajetória coletiva.</p>
        </div>
        <div class="dho-sintese" role="listitem">
          <p><strong>Impacto humano</strong>, com vontade de contribuir para a vida de outras pessoas por meio do trabalho.</p>
        </div>
        <div class="dho-sintese" role="listitem">
          <p><strong>Expansão patrimonial</strong> como símbolo de conquista, acompanhado de metas mais concretas de execução.</p>
        </div>
      </div>
    </section>

    <!-- ATO 2 | PRIORIDADES (CÍRCULOS) -->
    <section class="dho-ato" aria-label="Prioridades estratégicas nos próximos 12 meses">
      <div class="dho-ato-head">
        <h3 class="dho-ato-title">Prioridades estratégicas nos próximos 12 meses</h3>
        <p class="dho-ato-lead">
          As prioridades se concentram em crescimento e tração comercial, com atenção também a bases que sustentam a operação, como caixa, eficiência e pessoas.
        </p>
      </div>

      <div class="dho-bubbles">
        <div class="dho-bubbles-cluster" aria-label="Principais prioridades (visual em círculos)">
          <!-- Triade principal -->
          <div class="bubble bubble-lg bubble-a" data-count="3">
            <div class="bubble-inner">
              <div class="bubble-count">3</div>
              <div class="bubble-label">Aquisição de clientes<br>e novos canais</div>
            </div>
          </div>

          <div class="bubble bubble-lg bubble-b" data-count="3">
            <div class="bubble-inner">
              <div class="bubble-count">3</div>
              <div class="bubble-label">Crescimento de receita<br>orgânica</div>
            </div>
          </div>

          <div class="bubble bubble-md bubble-c" data-count="2">
            <div class="bubble-inner">
              <div class="bubble-count">2</div>
              <div class="bubble-label">Caixa e capital<br>de giro</div>
            </div>
          </div>

          <!-- Satélites -->
          <div class="bubble bubble-sm bubble-s1" data-count="2">
            <div class="bubble-inner">
              <div class="bubble-count">2</div>
              <div class="bubble-label">Lucratividade<br>e eficiência</div>
            </div>
          </div>

          <div class="bubble bubble-xs bubble-s2" data-count="1">
            <div class="bubble-inner">
              <div class="bubble-count">1</div>
              <div class="bubble-label">Novos produtos<br>ou serviços</div>
            </div>
          </div>

          <div class="bubble bubble-xs bubble-s3" data-count="1">
            <div class="bubble-inner">
              <div class="bubble-count">1</div>
              <div class="bubble-label">Retenção e<br>customer success</div>
            </div>
          </div>

          <div class="bubble bubble-xs bubble-s4" data-count="1">
            <div class="bubble-inner">
              <div class="bubble-count">1</div>
              <div class="bubble-label">Talentos,<br>liderança e sucessão</div>
            </div>
          </div>

          <div class="bubble bubble-xs bubble-s5" data-count="1">
            <div class="bubble-inner">
              <div class="bubble-count">1</div>
              <div class="bubble-label">Digitalização e<br>automação</div>
            </div>
          </div>

          <div class="bubble bubble-xs bubble-s6" data-count="1">
            <div class="bubble-inner">
              <div class="bubble-count">1</div>
              <div class="bubble-label">Expansão geográfica<br>ou novos mercados</div>
            </div>
          </div>
        </div>

        <div class="dho-bubbles-note">
          <p class="dho-note">
            Leitura do gráfico: círculos maiores representam maior recorrência de menções. Os números indicam a contagem registrada.
          </p>
        </div>
      </div>
    </section>

    <!-- ATO 3 | PREPARAÇÃO -->
    <section class="dho-ato" aria-label="Preparação para entregar as prioridades">
      <div class="dho-ato-head">
        <h3 class="dho-ato-title">Preparação para entregar as prioridades</h3>
        <p class="dho-ato-lead">
          Ao avaliar recursos e planos, o quadro sugere uma base bem encaminhada. A diferença aparece quando o tema é acompanhamento contínuo, cadência e indicadores.
        </p>
      </div>

      <div class="dho-prep">
        <div class="dho-prep-row">
          <div class="dho-prep-item">
            <div class="dho-prep-name">Plano tático (MVP, etapas, datas, responsáveis)</div>
            <div class="dho-prep-desc">Plano completo, pronto para executar</div>
          </div>
          <div class="dho-scale" aria-label="Maturidade 5 de 5" data-score="5" data-max="5">
            <span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span>
          </div>
          <div class="dho-prep-score">5</div>
        </div>

        <div class="dho-prep-row">
          <div class="dho-prep-item">
            <div class="dho-prep-name">Recursos financeiros</div>
            <div class="dho-prep-desc">Quase pronto, recursos encaminhados</div>
          </div>
          <div class="dho-scale" aria-label="Maturidade 4 de 5" data-score="4" data-max="5">
            <span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span>
          </div>
          <div class="dho-prep-score">4</div>
        </div>

        <div class="dho-prep-row">
          <div class="dho-prep-item">
            <div class="dho-prep-name">Força de trabalho e clareza de competências críticas</div>
            <div class="dho-prep-desc">Quase pronto, recursos encaminhados</div>
          </div>
          <div class="dho-scale" aria-label="Maturidade 4 de 5" data-score="4" data-max="5">
            <span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span>
          </div>
          <div class="dho-prep-score">4</div>
        </div>

        <div class="dho-prep-row">
          <div class="dho-prep-item">
            <div class="dho-prep-name">Infraestrutura, ferramentas e tecnologia</div>
            <div class="dho-prep-desc">Quase pronto, recursos encaminhados</div>
          </div>
          <div class="dho-scale" aria-label="Maturidade 4 de 5" data-score="4" data-max="5">
            <span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span>
          </div>
          <div class="dho-prep-score">4</div>
        </div>

        <div class="dho-prep-row">
          <div class="dho-prep-item">
            <div class="dho-prep-name">Parcerias e fornecedores críticos</div>
            <div class="dho-prep-desc">Quase pronto, recursos encaminhados</div>
          </div>
          <div class="dho-scale" aria-label="Maturidade 4 de 5" data-score="4" data-max="5">
            <span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span>
          </div>
          <div class="dho-prep-score">4</div>
        </div>

        <div class="dho-prep-row">
          <div class="dho-prep-item">
            <div class="dho-prep-name">Mapa de riscos e planos de contingência</div>
            <div class="dho-prep-desc">Quase pronto, recursos encaminhados</div>
          </div>
          <div class="dho-scale" aria-label="Maturidade 4 de 5" data-score="4" data-max="5">
            <span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span>
          </div>
          <div class="dho-prep-score">4</div>
        </div>

        <div class="dho-prep-row">
          <div class="dho-prep-item">
            <div class="dho-prep-name">Governança e agendas de acompanhamento (metas e indicadores)</div>
            <div class="dho-prep-desc">Plano parcial, com pontos em aberto</div>
          </div>
          <div class="dho-scale" aria-label="Maturidade 3 de 5" data-score="3" data-max="5">
            <span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span>
          </div>
          <div class="dho-prep-score">3</div>
        </div>
      </div>

      <div class="dho-card" role="note" aria-label="Insight editorial sobre preparação">
        <h4 class="dho-card-title">Insight</h4>
        <p class="dho-card-text">
          A preparação aponta solidez para começar. O ponto sensível não está no plano em si, mas na disciplina de acompanhamento: cadência, indicadores e decisões de ajuste ao longo do caminho.
        </p>
      </div>

      <p class="dho-transition">
        Quando o objetivo está claro e os recursos começam a se organizar, a pergunta muda: o que pode impedir a entrega?
      </p>
    </section>

    <!-- ATO 4 | BARREIRAS -->
    <section class="dho-ato" aria-label="Barreiras da força de trabalho que podem comprometer a entrega">
      <div class="dho-ato-head">
        <h3 class="dho-ato-title">O que pode comprometer a entrega</h3>
        <p class="dho-ato-lead">
          Entre os fatores ligados à força de trabalho, os sinais mais fortes aparecem em alinhamento do dia a dia, preparação de liderança e foco. O recorte considera a percepção do público de negócios e também a visão de líderes.
        </p>
      </div>

      <div class="dho-chart-block">
        <div class="dho-chart-head">
          <div class="dho-chart-title">Fatores mais citados</div>
          <div class="dho-legend" id="dho-objetivosneg-legend"></div>
        </div>

        <div class="dho-chart-area">
          <canvas id="dho-objetivosneg-barreiras" aria-label="Gráfico de barras horizontais com fatores mais citados" role="img"></canvas>
        </div>

        <div class="dho-footnote">
          <p class="dho-note">
            Observação: os valores representam menções totais por fator. A leitura é indicativa, dado o volume reduzido de respostas.
          </p>
        </div>

        <div class="dho-splits" aria-label="Detalhamento por público (NEG e LID)">
          <div class="dho-splits-title">Detalhe por origem das menções</div>
          <ul class="dho-splits-list">
            <li><span class="lbl">Comunicação e processos desalinhados</span> <span class="meta">NEG 1 | LID 2</span></li>
            <li><span class="lbl">Liderança não preparada</span> <span class="meta">NEG 2 | LID 1</span></li>
            <li><span class="lbl">Saída de talentos e rotatividade</span> <span class="meta">NEG 1 | LID 1</span></li>
            <li><span class="lbl">Excesso de iniciativas, pouca priorização</span> <span class="meta">NEG 2 | LID 0</span></li>
            <li><span class="lbl">Falta de capacitação técnica</span> <span class="meta">NEG 2 | LID 0</span></li>
            <li><span class="lbl">Absenteísmo e licenças não planejadas</span> <span class="meta">NEG 0 | LID 1</span></li>
            <li><span class="lbl">Sobrecarga e risco de burnout</span> <span class="meta">NEG 0 | LID 1</span></li>
            <li><span class="lbl">Baixo espírito de equipe</span> <span class="meta">NEG 0 | LID 1</span></li>
            <li><span class="lbl">Competências comportamentais</span> <span class="meta">NEG 1 | LID 0</span></li>
          </ul>
        </div>
      </div>

      <div class="dho-card" role="note" aria-label="Insight editorial sobre barreiras">
        <h4 class="dho-card-title">Insight</h4>
        <p class="dho-card-text">
          O movimento é claro: o risco maior não parece ser a falta de intenção, e sim o atrito cotidiano. Alinhamento, liderança e priorização tendem a decidir se a estratégia vira entrega.
        </p>
      </div>
    </section>
  </div>

  <style>
    .dho-objetivosneg {
      padding: 34px 18px 26px;
    }

    .dho-objetivosneg-wrap {
      max-width: 1060px;
      margin: 0 auto;
    }

    .dho-objetivosneg-header {
      margin-bottom: 18px;
    }

    .dho-kicker {
      margin: 0 0 8px 0;
      font-size: 12px;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.70);
    }

    .dho-objetivosneg h2 {
      margin: 0 0 10px 0;
      font-size: 28px;
      line-height: 1.15;
      color: rgba(255,255,255,0.96);
    }

    .dho-subtitle {
      margin: 0;
      max-width: 920px;
      color: rgba(255,255,255,0.85);
      text-align: justify;
      text-justify: inter-word;
      line-height: 1.55;
      font-size: 15px;
    }

    .dho-ato {
      margin-top: 18px;
      padding-top: 14px;
      border-top: 1px solid rgba(255,255,255,0.10);
    }

    .dho-ato-head {
      display: grid;
      gap: 8px;
      margin-bottom: 12px;
    }

    .dho-ato-title {
      margin: 0;
      font-size: 18px;
      color: rgba(255,255,255,0.96);
    }

    .dho-ato-lead {
      margin: 0;
      color: rgba(255,255,255,0.85);
      text-align: justify;
      text-justify: inter-word;
      line-height: 1.55;
      font-size: 14px;
      max-width: 980px;
    }

    /* Sínteses (sem card pesado) */
    .dho-sinteses {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px 14px;
      margin-top: 10px;
    }

    .dho-sintese {
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.03);
      border-radius: 14px;
      padding: 12px 14px;
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 26px rgba(0,0,0,0.18);
    }

    .dho-sintese p {
      margin: 0;
      color: rgba(255,255,255,0.85);
      text-align: justify;
      text-justify: inter-word;
      line-height: 1.55;
      font-size: 14px;
    }

    .dho-sintese strong {
      color: rgba(255,255,255,0.96);
      font-weight: 600;
    }

    /* Bubbles cluster */
    .dho-bubbles {
      display: grid;
      gap: 12px;
      margin-top: 10px;
    }

    .dho-bubbles-cluster {
      position: relative;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.03);
      border-radius: 18px;
      padding: 16px;
      min-height: 360px;
      overflow: hidden;
      backdrop-filter: blur(12px);
      box-shadow: 0 12px 34px rgba(0,0,0,0.20);
    }

    .dho-bubbles-cluster::before {
      content: "";
      position: absolute;
      inset: -40px;
      background:
        radial-gradient(circle at 20% 20%, rgba(160,120,255,0.20), transparent 48%),
        radial-gradient(circle at 78% 30%, rgba(120,220,210,0.10), transparent 52%),
        radial-gradient(circle at 55% 78%, rgba(190,120,255,0.14), transparent 56%);
      filter: blur(10px);
      pointer-events: none;
    }

    .bubble {
      position: absolute;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.06);
      backdrop-filter: blur(12px);
      box-shadow: 0 10px 26px rgba(0,0,0,0.22);
      display: grid;
      place-items: center;
      overflow: hidden;
    }

    .bubble::after {
      content: "";
      position: absolute;
      inset: -30%;
      background: radial-gradient(circle at 30% 25%, rgba(255,255,255,0.16), transparent 40%);
      transform: rotate(12deg);
      pointer-events: none;
    }

    .bubble-inner {
      position: relative;
      padding: 14px 16px;
      text-align: center;
      display: grid;
      gap: 6px;
      width: 100%;
    }

    .bubble-count {
      font-size: 26px;
      line-height: 1;
      font-weight: 700;
      color: rgba(255,255,255,0.96);
    }

    .bubble-label {
      font-size: 12px;
      line-height: 1.15;
      color: rgba(255,255,255,0.85);
      text-wrap: balance;
    }

    .bubble-lg { width: 210px; height: 210px; }
    .bubble-md { width: 170px; height: 170px; }
    .bubble-sm { width: 128px; height: 128px; }
    .bubble-xs { width: 104px; height: 104px; }

    .bubble-a { left: 12%; top: 18%; }
    .bubble-b { right: 12%; top: 14%; }
    .bubble-c { left: 38%; top: 52%; }

    .bubble-s1 { left: 6%; top: 62%; }
    .bubble-s2 { right: 6%; top: 56%; }
    .bubble-s3 { left: 56%; top: 70%; }
    .bubble-s4 { left: 30%; top: 8%; }
    .bubble-s5 { right: 34%; top: 44%; }
    .bubble-s6 { left: 8%; top: 8%; }

    .dho-bubbles-note .dho-note {
      margin: 0;
      color: rgba(255,255,255,0.70);
      text-align: justify;
      text-justify: inter-word;
      line-height: 1.5;
      font-size: 13px;
    }

    /* Preparação */
    .dho-prep {
      display: grid;
      gap: 10px;
      margin-top: 10px;
    }

    .dho-prep-row {
      display: grid;
      grid-template-columns: 1fr auto 24px;
      gap: 12px;
      align-items: center;
      padding: 12px 12px;
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 14px;
      background: rgba(255,255,255,0.03);
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 26px rgba(0,0,0,0.16);
    }

    .dho-prep-name {
      color: rgba(255,255,255,0.96);
      font-weight: 600;
      font-size: 13px;
      margin-bottom: 4px;
    }

    .dho-prep-desc {
      color: rgba(255,255,255,0.70);
      font-size: 12.5px;
      line-height: 1.35;
      text-align: justify;
      text-justify: inter-word;
      max-width: 820px;
    }

    .dho-scale {
      display: inline-flex;
      gap: 6px;
      align-items: center;
      justify-content: flex-end;
      min-width: 132px;
    }

    .dho-scale .dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.03);
      box-shadow: 0 6px 14px rgba(0,0,0,0.16);
    }

    .dho-prep-score {
      color: rgba(255,255,255,0.70);
      font-size: 13px;
      font-weight: 700;
      text-align: right;
    }

    /* Cards de insight */
    .dho-card {
      margin-top: 12px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.07);
      border-radius: 16px;
      padding: 14px 16px;
      backdrop-filter: blur(12px);
      box-shadow: 0 14px 36px rgba(0,0,0,0.22);
    }

    .dho-card-title {
      margin: 0 0 6px 0;
      color: rgba(255,255,255,0.96);
      font-size: 13px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .dho-card-text {
      margin: 0;
      color: rgba(255,255,255,0.85);
      text-align: justify;
      text-justify: inter-word;
      line-height: 1.55;
      font-size: 14px;
    }

    .dho-transition {
      margin: 12px 0 0 0;
      color: rgba(255,255,255,0.85);
      text-align: justify;
      text-justify: inter-word;
      line-height: 1.55;
      font-size: 14px;
      max-width: 980px;
    }

    /* Chart block */
    .dho-chart-block {
      margin-top: 10px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.03);
      border-radius: 18px;
      padding: 14px 14px 10px;
      backdrop-filter: blur(12px);
      box-shadow: 0 12px 34px rgba(0,0,0,0.18);
    }

    .dho-chart-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 10px;
    }

    .dho-chart-title {
      color: rgba(255,255,255,0.96);
      font-weight: 650;
      font-size: 14px;
    }

    .dho-legend {
      display: flex;
      align-items: center;
      gap: 10px;
      color: rgba(255,255,255,0.70);
      font-size: 12px;
      white-space: nowrap;
    }

    .dho-legend .swatch {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.18);
      display: inline-block;
      margin-right: 6px;
    }

    .dho-chart-area {
      position: relative;
      height: 320px;
    }

    .dho-footnote .dho-note {
      margin: 10px 0 0 0;
      color: rgba(255,255,255,0.70);
      text-align: justify;
      text-justify: inter-word;
      line-height: 1.5;
      font-size: 13px;
    }

    .dho-splits {
      margin-top: 10px;
      border-top: 1px solid rgba(255,255,255,0.10);
      padding-top: 10px;
    }

    .dho-splits-title {
      color: rgba(255,255,255,0.70);
      font-size: 12px;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      margin: 0 0 8px 0;
    }

    .dho-splits-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: 6px;
    }

    .dho-splits-list li {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.03);
      border-radius: 12px;
      padding: 10px 12px;
    }

    .dho-splits-list .lbl {
      color: rgba(255,255,255,0.85);
      font-size: 13px;
    }

    .dho-splits-list .meta {
      color: rgba(255,255,255,0.70);
      font-size: 12.5px;
      white-space: nowrap;
    }

    /* Responsivo */
    @media (max-width: 880px) {
      .dho-sinteses {
        grid-template-columns: 1fr;
      }
      .dho-chart-area {
        height: 340px;
      }
      .dho-objetivosneg h2 {
        font-size: 24px;
      }
    }

    @media (max-width: 620px) {
      .dho-bubbles-cluster {
        min-height: 520px;
      }

      .bubble-lg { width: 190px; height: 190px; }
      .bubble-md { width: 156px; height: 156px; }
      .bubble-sm { width: 124px; height: 124px; }
      .bubble-xs { width: 104px; height: 104px; }

      .bubble-a { left: 6%; top: 10%; }
      .bubble-b { right: 6%; top: 26%; }
      .bubble-c { left: 24%; top: 48%; }

      .bubble-s1 { left: 6%; top: 70%; }
      .bubble-s2 { right: 6%; top: 66%; }
      .bubble-s3 { left: 48%; top: 78%; }
      .bubble-s4 { left: 52%; top: 6%; }
      .bubble-s5 { right: 34%; top: 54%; }
      .bubble-s6 { left: 6%; top: 34%; }

      .dho-prep-row {
        grid-template-columns: 1fr;
        gap: 10px;
        align-items: start;
      }

      .dho-scale {
        justify-content: flex-start;
      }

      .dho-prep-score {
        text-align: left;
      }

      .dho-splits-list li {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>

  <script>
    window.initBloco_objetivosNeg = async function initBloco_objetivosNeg() {
      const root = document.querySelector(".dho-objetivosneg");
      if (!root) return;

      // 1) Pinta escalas (dots) conforme score
      root.querySelectorAll(".dho-scale").forEach((el) => {
        const score = Number(el.getAttribute("data-score") || "0");
        const dots = Array.from(el.querySelectorAll(".dot"));
        dots.forEach((d, idx) => {
          const active = idx < score;
          d.style.background = active ? "rgba(255,255,255,0.18)" : "rgba(255,255,255,0.03)";
          d.style.borderColor = active ? "rgba(255,255,255,0.16)" : "rgba(255,255,255,0.10)";
        });
      });

      // 2) Legenda customizada (sem legenda padrão do Chart.js)
      const legendHost = document.getElementById("dho-objetivosneg-legend");
      if (legendHost) {
        legendHost.innerHTML = '<span class="swatch" aria-hidden="true"></span><span>Total de menções</span>';
      }

      // 3) Carrega Chart.js se necessário
      async function ensureChartJs() {
        if (window.Chart) return true;

        return new Promise((resolve) => {
          const existing = document.querySelector('script[data-dho-chartjs="1"]');
          if (existing) {
            existing.addEventListener("load", () => resolve(true));
            existing.addEventListener("error", () => resolve(false));
            return;
          }

          const s = document.createElement("script");
          s.src = "https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js";
          s.async = true;
          s.setAttribute("data-dho-chartjs", "1");
          s.onload = () => resolve(true);
          s.onerror = () => resolve(false);
          document.head.appendChild(s);
        });
      }

      const ok = await ensureChartJs();
      if (!ok) return;

      // 4) Gráfico de barreiras (horizontal)
      const canvas = document.getElementById("dho-objetivosneg-barreiras");
      if (!canvas) return;

      // Dados normalizados (inclui consolidação de "Lideranca não preparada")
      const data = [
        { fator: "Comunicação e processos desalinhados", total: 3 },
        { fator: "Liderança não preparada", total: 3 },
        { fator: "Saída de talentos e rotatividade", total: 2 },
        { fator: "Excesso de iniciativas, pouca priorização", total: 2 },
        { fator: "Falta de capacitação técnica", total: 2 },
        { fator: "Absenteísmo e licenças não planejadas", total: 1 },
        { fator: "Sobrecarga e risco de burnout", total: 1 },
        { fator: "Baixo espírito de equipe", total: 1 },
        { fator: "Competências comportamentais", total: 1 }
      ];

      // Ordena por total desc, depois por nome
      data.sort((a, b) => (b.total - a.total) || a.fator.localeCompare(b.fator, "pt-BR"));

      const labels = data.map(d => d.fator);
      const values = data.map(d => d.total);

      // Destroi instância anterior se recarregar
      if (window.__dhoObjetivosNegChart && typeof window.__dhoObjetivosNegChart.destroy === "function") {
        window.__dhoObjetivosNegChart.destroy();
      }

      const ctx = canvas.getContext("2d");
      window.__dhoObjetivosNegChart = new window.Chart(ctx, {
        type: "bar",
        data: {
          labels,
          datasets: [{
            label: "Total de menções",
            data: values,
            borderWidth: 1,
            borderColor: "rgba(255,255,255,0.18)",
            backgroundColor: "rgba(255,255,255,0.16)",
            borderRadius: 10,
            barThickness: 16
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          indexAxis: "y",
          plugins: {
            legend: { display: false }, // legenda sempre customizada em HTML
            tooltip: {
              callbacks: {
                label: (ctx) => ` ${ctx.parsed.x} menções`
              }
            }
          },
          scales: {
            x: {
              beginAtZero: true,
              ticks: {
                color: "rgba(255,255,255,0.70)",
                precision: 0
              },
              grid: {
                color: "rgba(255,255,255,0.08)"
              },
              border: {
                color: "rgba(255,255,255,0.10)"
              }
            },
            y: {
              ticks: {
                color: "rgba(255,255,255,0.85)",
                font: { size: 12 }
              },
              grid: {
                display: false
              },
              border: {
                color: "rgba(255,255,255,0.10)"
              }
            }
          }
        }
      });
    };
  </script>
</section>
